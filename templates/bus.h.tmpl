{{define "bus_h"}}

// HEADER FILE
// Bus name is {{ .Bus.Name }}
// Bus type is {{ .Bus.Type }}
// Bus --> .NodeInterfaces() --> .SentMessages() --> .Signals()
// {{ range .Bus.NodeInterfaces }}
    // node interface number = {{ .Number }}
    // node = {{ .Node.ID }}
    {{ range .SentMessages }} // messages ID sent = {{ .ID }}: {{ .Name }}, 
        // signals sent = {{ range .Signals }}
            ENUM SIGNALS:
            {{ if (eq .Kind.String "enum") }}{{ range .Enum.Values }}name={{ .Name }}{{ end }}
            {{ else }}{{ if (eq .Kind.String "standard") }}STANDARD SIGNALS:
            {{ .ToStandard }}
            {{ else }}MULTIPLEXED SIGNALS:
            {{ .ToMultiplexer }}{{ end }}{{ end }}
        {{ end }}
    {{ end }}
{{ end }}
 
/**
 * This file was generated by GHESBORO OMAR!! impazzisco - version 0.1.
 */

#ifndef {{ .dbName | toUpper }}_H
#define {{ .dbName | toUpper }}_H

#ifdef __cplusplus
extern "C" {
#endif

#include <stdint.h>
#include <stdbool.h>
#include <stddef.h>

#ifndef EINVAL
#    define EINVAL 22
#endif

/* Frame ids. */
{{- range .Bus.NodeInterfaces -}}
{{- range .SentMessages }}
#define {{ $.dbName | toUpper }}_{{ .Name | camelToSnake | toUpper }}_FRAME_ID ({{ .ID | toUint }})
{{- end -}}
{{- end }}

/* Frame lengths in bytes. */
{{- range .Bus.NodeInterfaces -}}
{{- range .SentMessages }}
#define {{ $.dbName | toUpper }}_{{ .Name | camelToSnake | toUpper }}_LENGTH ({{ .SizeByte | toUint }})
{{- end -}}
{{- end }}

/* Extended or standard frame types. */
{{- range .Bus.NodeInterfaces -}}
{{- range .SentMessages }}
#define {{ $.dbName | toUpper }}_{{ .Name | camelToSnake | toUpper }}_IS_EXTENDED ({{ .ID | isExtended }})
{{- end -}}
{{- end }}

/* Frame cycle times in milliseconds. */
{{- range .Bus.NodeInterfaces -}}
{{- range .SentMessages }}
#define {{ $.dbName | toUpper }}_{{ .Name | camelToSnake | toUpper }}_CYCLE_TIME_MS ({{ .CycleTime | toUint }})
{{- end -}}
{{- end }}

/* Signal choices. */
{{- range .Bus.NodeInterfaces -}}
{{- range .SentMessages }}
{{- $messageName := .Name }}
{{- range .Signals }}
{{- $signalName := .Name }}
{{- if (eq .Kind.String "enum") }}
{{- range .Enum.Values }}
#define {{ $.dbName | toUpper }}_{{ $messageName | camelToSnake | toUpper }}_{{ $signalName | camelToSnake | toUpper }}_{{ .Name | camelToSnake | toUpper }}_CHOICE ({{ .Index }}u)
{{- end }}
{{- end }}
{{- end }}
{{- end }}
{{- end }}

/* Frame Names. */
{{- range .Bus.NodeInterfaces -}}
{{- range .SentMessages }}
{{- if and (ne .Name "") (or (gt (len .Receivers) 0) (ne .SenderNodeInterface nil)) }}
#define {{ $.dbName | toUpper }}_{{ .Name | camelToSnake | toUpper }}_NAME ("{{ .Name }}")
{{- end }}
{{- end -}}
{{- end }}

/* Signal Names. */
{{- range .Bus.NodeInterfaces -}}
{{- range .SentMessages }}
{{- if and (ne .Name "") (or (gt (len .Receivers) 0) (ne .SenderNodeInterface nil)) }}
{{- $messageName := .Name }}
{{- range .Signals }}
#define {{ $.dbName | toUpper }}_{{ $messageName | camelToSnake | toUpper }}_{{ .Name | camelToSnake | toUpper }}_NAME ("{{ .Name }}")
{{- end }}
{{- end }}
{{- end }}
{{- end }}

/* Struct */
/* Declarations */ 

{{ range .Bus.NodeInterfaces }}{{ range .SentMessages }}{{ $messageName := .Name }}
/* Signals in message {{ $messageName }} */
struct {{ $.dbName | toLower }}_{{ $messageName | toLower }}_t {
{{ range .Signals }}
    /**
     * Range: 
     * Scale:
     * Offset:
     * start value: {{ .StartValue }}
     * send type: {{ .SendType }}
     * get start bit: {{ .GetStartBit }}
     * get size: {{ .GetSize }}
     */
    uint8_t {{ .Name | toLower }};
    {{ end }}
};
{{ end }}{{ end }}


#define BUS_NAME "{{ .Bus.Name }}"

// typedef struct for a message
typedef struct {
    int id;
} Message;

#ifdef __cplusplus
}
#endif

#endif
{{end}}